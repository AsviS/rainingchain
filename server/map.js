//Map
Init.db.map = function (){
	Db.map = {};
	
	Db.map['test'] = function(){
		var m = {};
		m.name = "Test";
		m.grid = ['000000000000000000000000000000000000100000000000000000000000100000000000000000000000000000000000','000000000000000000000000000000000000100000000000000000000000100000000000000000000000000000000000','000000000000000000000000000000000000100000000000000000000000100000000000000000000000000000000000','000000000000000000000000000000000000100000000000000000000000100000000000000000000000000000000000','000000000000000000000000000000000000100000000100000010011000100000000000000000000000000000000000','000000000000000000000000000000000000100000000100000010000000100000000000000000000000000000000000','000000000000000000000000000000000000100000000000000000000000100000111110000000000000000000000000','000000000000000000000000111111111111100000000000000000000000111111100010000000000000000000000000','000000000000000000000000100000000000000000000000000000000000000000000010000001111100000000000000','000000000000000000000000100110000000000000000000000000000000000000000010000111000110000000000000','000000000000000000000000100110000000000000000000000000000000000000000001111100000110000000000000','000000011111000000000000100000000000000000000000000000000000000000011000000000000110000000000000','000000010001000000000000100000000000100000000000000000000000000000011000000000000010000000000000','000001110001000000000000100000000000000000000000000000000000000110000000000000000010000000000000','000001000001000000000000100000000000000000000000000000000000000000000000000000000010000000000000','000001001101000000000000100000000000000000000000000000000000000000000000000000000010000000000000','000001001101000000000000111110000000000000000011000000000000000000000000001111111111110000000000','000001000001000000000000111010000000000000000011000000000000000000000000011000000010010000000000','000001110111000000000000110010000000000000000000000000000000000000000000010000000001010000000000','000000010111000000000000110010000000000000000000000000000000000000000000010000000001010000000000','000000010001000000000000110010000000000000000000000000000000000000000000010000000000111100000000','000000010001000000000000111110000000000000000000000011111100000000000000010000000000010110000000','000000010001111111111111100000000000000000000000111110000100001100000000010000000000010010000000','000000010000000000000000000000000000000000001111100000000110001100000000010000000000010010000000','000000010000000000000000000000000000000001111000000000000010001100000000010000000000010010000000','000000010000000000000000000000000000111111000000000000000010001100000000011100000011110110000000','000000010001100000000000000000000000100000000000000000000011100000000000001000000010000100000000','000000010001100000000000000000000000100000000000000000000000100000000000001000000010000100000000','000000110000000000000000000000000001100000000000000011000000100000000011111000000010000100000000','000000100000000000000000000000000001000000110000000011000000100000000011111111111110000100000000','000000100000000000000001000000000001000000110011110000000000100000000000000000000000000100000000','000000100000000000000000000000000001000000110011110000000000100000000000000000000000000100000000','000000110000000000000000000000000011000000001000000000000000100000000000000000000000000111000000','000000010000000000000000000000000010000000000000000000000111100000000000000000000000000001100000','000000010000000000000000000000000010000000000000000000000111100010000000000000000011000001100000','000000010000000000000000000000000010000000000000000000000111100000000000001111000011000000100000','000000011111000000000000000000000010000000000000000000000111100000000000001111000000000000100000','000000000001000000000000000000000010000000000000000000000111100000000000001111000000000000100000','000000000001111000000000000000000011000000000000000000000100000000000000000000000000000001100000','000000000000001000000000000000000011100000000000000000000100000000000000001111000000000001000000','000000000000001001000000000000000011110000000000000000000100000000000000011001111000000001000000','000000000000001000000000000011000011111100000000000000000100000000000000010000001111000001000000','000000000000001000000000000011000001111110000000000000000100000000000000010000000001100111000000','000000000000001100000000000000000000111111000001100000001100000000000000010000000000111100000000','000000000000000100000000000000000000111111000001111111111100000000000000010000000000000000000000','000000000000000100000000000000000000001111000001111011100100000001000000010000000000000000000000','000000000000000100000000000000000000000011000001100000000100000000000000010000110000000000000000','000000000000000100000000000000000000000011000001100000011100000000000000010000110000000000000000','000000000000000100000000000000000000000000000000111111110000000000000000011000000000000000000000','000000000000000100000000000000000000000000000000000000000000000000000000001000000000000000000000','000000000000000100000000000000000000000000000000000000000000000000000000001000000000000000000000','000000000000000100000110000000000000000000000000000000110000000000000000001000000000000000000000','000000000000000100000110000000000000000000000000000000110000000000000000001000000000000000000000','000000000000001100000110000000000000000000000000000000000000000000000011001000000000000000000000','000000000000001000000110000000000000000000000000000000000000000000000011001100000000000000000000','000000000000001000000000000000000000000000000000000000000000000000000011000100000000000000000000','000000000000001000000000000000000000000000000000000000000000000000000011000100000000000000000000','000000000000001000000000000000000000000000000000000000000001000000000000000100000000000000000000','000000000000111000000000000000000000000000000000000000000000000000000000000111110000000000000000','000000000011100000000000000000000000000000000011110000000000000000000000000000010000000000000000','000000001110000000000000000001000000000000000011110000000000000000000000000000011100000000000000','000000001000000000000000000000000000000000000000000000000000000000000000000000000100000000000000','000000001000000000111111110000000000000000000000000000000000000000000000000000000100000000000000','000000001000000011100000011100000000000000000000000000000000000000111111111111100100000000000000','000000011000001110000000000100000000000111100000000000000000001111100000000000111100000000000000','000000010000001010000000000100000000000111100000000000000000001000000000000000001100000000000000','000000010000001000000000000100000000000111100000000000000000011000000000000000000111000000000000','000000010000001000000000000100000000000000000000000000000000010000000000000000000101010000000000','000000010000001000000000000100000000000000000000000000000000010000000000000000000101110000000000','000000011100001110000000111100000000000000000000000000000000010000000000000000000100111000000000','000000000100000010000000100000000000000000000000000000000000010000000000000000000100011000000000','000000000100000010000000100000000000000000000000000000110000010000000000000000000100011000000000','000000000100000010000000100000000110000000000000000000110000011110000000000000000100011000000000','000000000100000011111111100000000110000000000000000000000000000010000000000000000100001000000000','000000000100000000000000000000000000000000000000000000000000000010000000000000011100001000000000','000000000100000000000000000000000000000000000000000000000000000010000000000000010000011000000000','000000000100000000000000000000000000000000000110000000000000000010000000000000010000010000000000','000000000100000000000000000000000000000010000110000000000000000010000000000000010000010000000000','000000000100000000000000000000000000000000000000000110000000000011111111111111110000010000000000','000000000111111100000000000000000000000000000000000000000000000000000000110000000000010000000000','000000000000000100000000000000000000000000000000000000000000000000110000110111100000010000000000','000000000000000110000000000000000000000000000000000000000000000000000000000111100000010000000000','000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000','000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000','000000000000000011000000000000000000000000000000000000000000000000000000000000000000110000000000','000000000000000001000000000000000000000000000000000000000000000000000000000000000000100000000000','000000000000000001000000000000000000000000000000000011000000000000011110000000000111100000000000','000000000000000001100000000000000000000000000000000011000000001111011110000000000100000000000000','000000000000000000100000000000000000000000011111000000000000001111000000000000000100000000000000','000000000000000000100000000001111111111000010001110000000000000000000000000000111100000000000000','000000000000000000111000000001000000001000010000011111111111111111110000000000100000000000000000','000000000000000000001000000001000000001111110000000000000000000000011000111111100000000000000000','000000000000000000001111111111000000000000000000000000000000000000001111100000000000000000000000','000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000']
		m.load = {};
		m.load.main = function(map){
			Actor.creation.group({'x':1060,'y':1900,'map':map,'respawn':100},[
				{'amount':1,"category":"troll","variant":"ice",'lvl':0,'modAmount':1},
			]);
		}
		
		
		m.loop = {};
		m.loop.main = function(map,variable,cst){
			if(Loop.interval(10) && false){
				Map.collisionRect(map,[1000,1400,1000,1400],'player',function(key){
					var mort = List.all[key];
					mort.hp -= 100;
					
					Attack.creation(
						{x:mort.x,y:mort.y,map:map,hitIf:'enemy',angle:mort.angle},
						useTemplate(Attack.template(),cst.atk)
					);
					
				});
			}
		}
		
		
		
		m.cst = {
			atk:{'type':"bullet",'angle':15,'amount':1, 'aim': 0,'objImg':{'name':"iceshard",'sizeMod':1},'hitImg':{'name':"ice2",'sizeMod':0.5},
				'dmg':{'main':1,'ratio':{'melee':0,'range':10,'magic':80,'fire':10,'cold':0,'lightning':0}}},	
		};
		return m;
	};
	//ts("Actor.creation.group({'x':1060,'y':1900,'map':'test@MAIN','respawn':100},[{'amount':1,'category':'boss','variant':'iceTroll','lvl':0,'modAmount':1},]);")
			
		
		
	Db.map['ryve'] = function(){
		var m = {};
		m.name = "Ryve";
		m.grid = ['0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000100000100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000001111000000000000100000100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000011001000000000000100000100000000000111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000011111111111110001100011111111100000111111110000100011000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000011111111111100001111110000000100000111000011111100011000000000000111111111111111111111111000000000000000111100000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000111111111111100000000000000001000000011011000000000011000000000000000000000001000000000001000000000000000111100000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000111111111111111100000000000000001000000011011000000000111110000000000000000000010000000000001000000000000001111100000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000110011111111111100000000000000001000000000011100000000001110000000000000000000100000000000001111111111111111101100000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000011100011111111111100000000000000001000000000000110000000111100000000011000000000100000000000010000000000000000001100000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000011000011111111111100000000000000001000000000000011111111100000000000011000000000100000000000010000000000000000001100000000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000010000011111111111100000000000000001000000000000000000111100000000000011000000000100000000000010000000000011100001100000000000000000000000000000000000000000001010000000000000111111111111111100000000000000001111111111111','0000000000000000000000000000000010000011111111111100000000000000111000000000000000000111100000000000000000000000100000000000010000000000011100001000000000000000000000000000000000000000000001011000000000011100000010001100100000000000000001001111111000','0000000000000000000000000000000010000011111111111100000000111111100000000000000000000000000000000000000000000000100000000000011100000000000000111000000000000000000000000000000000000000000001001100000000110000000010011100100000000000000001001111111000','0000000000000000000000000000000010000011111111111100111111111001100000000000000000000000000000000011111100000000100000000000011100000000000000110000000000000000000000000000000000000000000001000110000001100000000010011100100000000000000001001111110000','0000000000000000000000000000001110000011111111111101100001111000000000000000000000000000000110000011111100000000100000000000011100000000000011100000000000111110000000000000000000000000000001000010000011000000000010001100111111111111111111001111110000','0000000000000000000000000000001000000011111111111111000000000000000000000000000000000000000110000011111100000000100000000000011100000000000011000000000011100010000000000000000000000000000001100011001110000000000010011100000000000000000000001111110000','0000000000000000000000000000001000000000000000011110000000000000000000000000011110000000000000000011111100000000111111111111110000000001111111100000011110000010000000000000000000000000000000100011111000000000000010011000000000000000000000000111110000','0000000000000000000000000000011000000000000000011110000111111000000000000000011110000000000000000000000000000000000000000000000000000001000000000001110000000011000000000000000000000000000000100000110000000000000011110000000000000000000000000111110000','0000000000000000000000000000110000000000000000000000000111111000000000000000011110000000000000000000000000000000000000000000000000000111000000000001100000000001100000000000000000000000000000100000010000000000000000000000000000000000000000000000000000','0000000000000000000000000000110000000000000000000000000111111000000000000000011110000000000000000000000000000000000000000000111000001100000000000011000000000000100000000000000000000000000000110000010000000000000000000000000000000000000000000000000000','0000000000000000000000000000110000000000000000000000000000000000000000000000011110000000000000000000000000000000000000000001111001111100000000000110000000000000110000000000000000000000000000010000010000000000000000000000000000000000000000000000000000','0000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111100000000000011100000000000000011000000000000000000000000000011000011111110000000000000000000000000000000000000000000000','0000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000001100000000000000000000000000001000000000011110000000000000000000000000000000000000000000','0000000000000000000100000000100000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000110000000000000000000110000000000000000000000000001100000000000111111000000000000000000000000011000000111100','0000000000000000000111111111100001111000000100100000000000000000000000000000000000000000000000000000000000000000000000000000000100000001000001100000000000000000000011000000000000000000000000000110000000000000001110000000000000000000000011000000111100','0000000000000000000100000000000001111000000111100000000000000000000000000000000000000000000000000000000000000000000000000000000100000000110011001100000000000000000001100000000000000000000000000010000000000000000010000000000000000000000011000000111100','0000000000000000000100000000000000000000000111100000000000000001111110000000000000000000000000000000000000000000000000000000000100000000001110011110000000000000000000111000000000000000000000000011000000000000000010000000000000000000000000000000111100','0000000000000000000111000000000000000000000111100000000000000001111110000000000000000000000000111111000000000000000000000000000100000000000100011110000000000000001110001100000000000000000000000001100000000000000011111110000000000000000000000000000000','0000000000000000000001100000000000000000000111100000000000000001111110000000000000000000000111100001111111110000000000000000000100000000000011000000000000000000011110000111000000000000000000000000110000000000000000000011100000000000000000000000000000','0000000000000000000000100000000000000000000011000000000000000000000000000000000000000000001000000000000000011100000000000000000110000000000000100000000001111111011110000000100000000000000000000000010000000000000000000000111100000000000000000111110011','0000000000000000000000110000000000000000000000000000000000000000000000000000000000000000001000000000000000000010000000000000000111000000000000011000000001111111000000000000010000000000000000000000010000000000000000000000000100000000000000011100011110','0000000000000000000000011000000000000000000000000000000000000000000000000000000000000000001100000000000000000011100000000000000001100000000000000100000001111111000000000111111100000000000000000000011000000000000000000000000100000000000000010000000000','0000000000000000000000001000000000000000000000000000000000000000000000000000000000000000001100000000000000000000010000000000000000011000000000000010000000000000000000000100000010000000000000000000011111110000000000000000000100000000000000010000000000','0000000000000000000000001110000000000000000000000000000000000001111111111001100000000000000100000000000000000000010100100000000000000100000000000001100000000000000000000100000111100000000000000000000000011110000000000000000100000000000000010000000000','0000000000000000000000000011000000000000000000000000000000000111111111111001100000000000000110000000000000000000001111100000000000000010000000000000010000000000000000000100000100110000000001111111110000010010000000000000000100000000000000010000000000','0000000000000000000000000001000000000000000000000000000001111101111111111100000000000000000011000000000000000000001111100000000000000001100000000000010000000000000000000111111100111000000001000000010000010010000000000000000100000000000000010000000000','0000000000000000000000000001110000000000000000000000000111000001111111111111000000000000000011000000000000000000001111100000000000000000010000000000011111111111111100000011100000001101111111000000011111110010000000000000000100000000000000010000000000','0000000000000000000000000000011000000000000000000000001100000001111111111001100000000000000000110000000000000000001111100000000000000000001000000000010000000000000100000000000000001101000000000000000000000010000000000000000100000000000000010000000000','0000000000000000000000000000001000000000000000000000011000000001111111111000100000000000000000011000000000000000001011000000000000000000000110000000010000000000000101100000000111000110000000000000000000000010000000000100000100000000000000010000000000','0000000000000000000000000000001000000000000000011000010000000001111111111000110110000000000000000100000000000000010000000000000000000000000001000000010000000000001101100000000111000100000000000000000000000010000000000111100100000000000000010000000000','0000000000000000000000000000001100000000000000011000010000000001111111111000011110000000000000000111000000000000100000000000000000000000000000100001110000000000000111110000000000001000000000000000000000000010000000000100111100000000000000011111111111','0000000000000000000000000000000110000000000000111100011100000000000000000000011111100000000000000001100000000111000000000000000000000000000000011011000000000000000000110000000000010000000000000000000000000010000000000100000100000000000000011000000000','0000000000000000000000000000000011100001000000000000010100000000000000000000011111110000000000000000111000111000000000000000000000000000000000000111000000000000000000111111000000100000000000000000000000000011111111111100000100000000000000010000000000','0000000000000000000000000000000011100001000000000000011100000000000000000000010011110000000000000000001111100000000000000000000000000000000000000001111110000000000000000001000001000001000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000011100001000000000000000100000000000000000000010111110000000000000000000000000000000000000000000000000000000000000000000110000000000000000001000010000010000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000011100001100000000000000111111110000000000000011111000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111000100000100000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000100001100000000000110000001111110000000000011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000001000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000100001111110000000110000000001111000100001011111000000000000000000000000000000000000000000000000000000000011110000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000100001000011100000000000011111101111100001011100000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000000111111111','0000000000000000000000000000000000100001000000110000000000001111000011100001111110000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000010010000000000000000000000000000000000000000000000000000000000000100000000','0000000000000000000000000000000000100001000000011110000000000110000000100001111110000000000000000000000000011111000000000000000000000000001111111100000000000000000000000000000100010000000000000000000000000000000000000000000000000000000000011100000000','0000000000000000000000000000000000100001000000000011000000000000000000100001011100000000000000000000000000011111110000000000000000000000001111111100000000000000000000000000001000010000000000000000000000000000000000000000000000000000000000010000000000','0000000000000000000000000000000000100001000000000001111110000000000000000000000000000000000000000011111000011111110000000000000000000000001111111100000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000010000000000','0000000000000000000000000000000000100001000000000000000010000000000000000000000000000000000000000011111000011111000000000000000000000000001111111000000000000000000000000000000000011111100000000000000000000000000000000000000000000000000000010000000000','0000000000000000000000000000000000100001000000000000000011111100000000000000000000000000000000000000000000000000000000000000000000000000000011110000000000000000000000000000000000010000100000000000000000000000000000000000000000000000000000010000000000','0000000000000000001111111111111111100001000000000000000000000111100000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000010000111000111111111100000000000000000000000000000000000000010000000000','0000000000000000001000000000000000000001000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000010000001001111111111100000000000000000000000000000000000000010000000000','0000000000000000001000000000000000000001000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000011000000000000000000000001100000000000000000000010000001111111111111100000000000000000000000000000000000000010000000000','0000000000000000001000000000000000000001000000000000000000000000001100000000000000000000000000111000000000000000000000000011111000000000000000000000000000001100000111111111111111111110000011111111111100000000000000000000000000000000000000011111111111','0000000000000000001000000000000000000001000000000000000000000000000110000000000000000000000000111000000000000000000000000011111100000000000000000000000000001100000111111111111111111011000001111111110000000000000000000000000000000000000000000000000000','0000000000000000001000000000000000000001000000000000000000000000000010000000000000000111000000000000000000000000000000000011111100000000000000000000000000000000000111111111111111111001100001111111000000000000000000000000000000000000000000000000000000','0000000000000000001000000000000000000001000000000000000000000000000010000000110000000111000000000000000000000000000000000011111100000000000000000000000000000000000111111111111111111000110000000001111111000000000000000000000000000000000000011111111111','0000000000000000001000011111111111111111000000000000000000000000000011000000110000000000000000000000000000000000000000000011111100000000000000000000000000000000000111111111111111111000001000000000000001000000000000000000000000000000000000010000000000','0000000000000000001000010000000000000001000000000000000000000000000001100000000000000000000000000000000000000000000000000001111111110000000000000000000000000000000111111111111111111000001110000000000001111100000000000000000000000000000000010000000000','0000000000000000001000010000000000000001000000000000000000000000000001100000000000000000000000000000000110000000000000000000111000011100000000000000000000000000000111111111111111111000001111000000000000000111100000000000000011111111111111111000000000','0000000000000000001000010000000000000000000000000000000000000000000000100000000000000000000000000000000110000000000000000000100000000100000000000000000000000110000111111111111111111000000011000000000000000000100000000000000010000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000111100000000000000000000000000000000000000000000000011100000000110000000000000000000000110000111111111111111111000111001110000000000000000100000000000000010000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000100000000000000000000011100000000000000000000000010000000000011000000000000000000000000000111111111111111111000111000111111000000000000100000000000000010000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000111100000000000000000110111100000000000000000000010000000000001111000000000000000000000000111111111111111111000000000000001111111100000100000000000000010000000000000011111111111','0000000000000000001000010000000000000000000000000000000000000000000000000000111111111111111111100000100000000000000000000010000000000000001000000000000000000000000111111111111110000000000000000000000001000000100000000000000010000000000000010000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000010000000000000001000000000000000000000000111111111111111100000000000000000000001111100100000000000000010000000000000010000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000010000000000000001100000000000000000000000011000000000001100000000000000000000000000111100000000000000011111111111111110000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000010000000000000000100000000000000000000000011000000000000000000000000000000000000000000100000000000000010000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000001111000000000000000010000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000011000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000001100000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000001010000100000111001100000000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000001010000100000111000110000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000001110000100000000000011000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000000000001000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000111100000000001100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100100000000000110000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100111000000000011000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100001100000000001000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000110000000001111111000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000011100000000000001111000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000000111000000000000001111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111110000100000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100011000000000100000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000100000000000000011000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111000000000000100000000000000001100000000110000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000100000000000000000111000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000100000000000000000001100001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000100000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001111111111100000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000100000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000100000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100001000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000','0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',];
		m.load = {};
		m.load.main = function(map){
			/*
			Actor.creation.group({'x':3000,'y':1800,'map':map,'respawn':100},[
				{'amount':1,"category":"boss","variant":"iceTroll","lvl":0,'modAmount':1,
					extra:{
						death:(function(killers){
							for(var i in killers){
								Db.quest['questId'].bossKilled(i);
							}
						})
					}
				}
			]);
			*/
		};
		m.loop = {};
		m.loop.main =  function(map){

			
		}
		
		return m;
	};

	
	for(var m in Db.map){	
		Db.map[m] = Db.map[m]();
		Db.map[m].id = m;
		Map.creation.model(Db.map[m]);
	}
	
}
Map = {};

Map.creation = function(namemodel,version){
	//create a copy of a default map. used for instanced map. version is usually the player name
	version = version || 'MAIN';
	var newid = namemodel + '@' + version;
	var model = Db.map[namemodel];
	
	var map = {
		id:newid,
		name:model.name,
		version:version,
		grid:model.grid,
		model:model.id,
		timer:version === 'MAIN' ? 1/0 : 5*60*1000/25,
		list:{},		//acts like List.all (for faster activeList)
		loop:deepClone(model.loop),
		variable:deepClone(model.variable),
		cst:model.cst,
	};
	
	List.map[newid] = map;
	
	Map.mapMod[newid] = {};
	
	Map.load(namemodel,newid);
	return newid;
}

Map.creation.model = function(map){
	var grid = [];
	for(var i = 0 ; i < map.grid.length; i++){	
		grid[i] = [];
		for(var j = 0 ; j < map.grid[i].length; j++){
			grid[i][j] = +!+map.grid[i][j];
		}
	}
	map.grid = new astar.Graph(grid);
	map.variable = map.variable || {};
	map.cst = map.cst || {};
	return map;
}

Map.creation.all = function(){
	for(var i in Db.map){
		Map.creation(i);
	}
}

Map.mapMod = {};

Map.getModel = function(name){
	return List.map[name].model;
}	
Map.load = function(model,loadedmapid){
	loadedmapid = loadedmapid || model + '@MAIN';
	for(var i in Db.map[model].load){
		Db.map[model].load[i](loadedmapid,i);
	}
}


Map.instance = {};
Map.instance.list = function(name){
	var list = [];
	for(var i in List.map){
		if(List.map[i].model === name){
			list.push(List.map[i].id);
		}
	}
	return list;
}

Map.instance.player = function(name){
	//return list of players that are in a certain model of instance
	var list = [];
	for(var i in List.main){
		if(List.map[List.all[i].map].name === name){
			list.push(List.all[i].name);
		}
	}
	return list;
}

Map.remove = function(map){
	if(map.id === map.model) return; //cant delete main maps
	var id = map.id;
	for(var i in List.all){
		if(List.all[i].map === id){
			remove(List.all[i]);
		}
	}
	delete List.map[id];
}


Map.collisionRect = function(map,rect,type,cb){	
	var list = List.map[map].list;
	var array = [];
	for(var i in list){
		var mort = List.all[i];
		if( (!type || mort.type === type) && Collision.PtRect(mort,rect)){
			array.push(i);
		}
	}
	if(!cb) return array;
	
	for(var i in array){
		cb(array[i]);	
	}
}




